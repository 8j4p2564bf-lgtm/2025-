<!DOCTYPE html>
<html lang="zh-TW" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>京都・大阪 5天4夜自由行</title>
    <meta name="description" content="5-Day Kyoto & Osaka Family Trip Itinerary">
    <meta name="theme-color" content="#0f172a">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              gray: {
                750: '#2d3748',
                850: '#1a202c',
                950: '#0b1120',
              }
            },
            fontFamily: {
              sans: ['Noto Sans TC', 'sans-serif'],
            }
          }
        }
      }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body {
        font-family: 'Noto Sans TC', sans-serif;
        background-color: #0f172a; /* Slate 900 */
        color: #f1f5f9;
        -webkit-tap-highlight-color: transparent;
        overscroll-behavior-y: none;
      }
      .no-scrollbar::-webkit-scrollbar {
          display: none;
      }
      .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      .glass {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }
      .glass-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      @keyframes slideUp {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-slideUp {
        animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }
      .animate-fadeIn {
        animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }
      .safe-bottom {
        padding-bottom: env(safe-area-inset-bottom, 24px);
      }
      .safe-top {
        padding-top: env(safe-area-inset-top, 20px);
      }
    </style>
    
    <!-- Import Map -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        MapPin, Clock, Info, X, Ticket, FileText, 
        Plane, Train, BedDouble, Camera, Utensils, ShoppingBag, 
        Calendar, Building, ChevronDown, ChevronUp, Map, AlertTriangle,
        ExternalLink, Home, CloudSun, Sun, CloudRain, Calculator, Phone, RefreshCw
      } from 'lucide-react';

      // --- Constants & Data ---

      const ActivityType = {
        FLIGHT: 'FLIGHT',
        HOTEL: 'HOTEL',
        TRANSPORT: 'TRANSPORT',
        ATTRACTION: 'ATTRACTION',
        FOOD: 'FOOD',
        SHOPPING: 'SHOPPING',
        OTHER: 'OTHER'
      };

      const TRIP_DATA = {
        flights: {
          outbound: {
            airline: '中華航空',
            flightNumber: 'CI0152',
            departureTime: '09:00',
            arrivalTime: '12:50',
            departureAirport: 'TPE (桃園)',
            arrivalAirport: 'KIX (關西)',
          },
          inbound: {
            airline: '中華航空',
            flightNumber: 'CI0153',
            departureTime: '14:00',
            arrivalTime: '15:55',
            departureAirport: 'KIX (關西)',
            arrivalAirport: 'TPE (桃園)',
          },
        },
        hotels: {
          kyoto: "Hotel The M’s Kyoto",
          osaka: "The Bridge Hotel Shinsaibashi",
        },
        itinerary: [
          {
            day: 1,
            date: '10/16 (四)',
            title: '京都初印象：嵐山＋月燈路',
            weather: { temp: '16°C - 24°C', condition: 'Sunny', icon: 'Sun' },
            activities: [
              {
                time: '05:30',
                title: '前往桃園機場',
                description: '竹北出發前往桃機2航廈。預算現金1500元。',
                price: '現金1500',
                type: ActivityType.TRANSPORT,
                location: '桃園國際機場第二航廈'
              },
              {
                time: '09:00',
                title: '飛往日本',
                description: '搭乘中華航空 CI0152 航班。機上提供午餐。',
                type: ActivityType.FLIGHT,
              },
              {
                time: '13:00',
                title: '抵達關西機場',
                description: '辦理入境手續、領取行李。請先填寫好 Visit Japan Web。',
                type: ActivityType.OTHER,
                location: 'Kansai International Airport'
              },
              {
                time: '14:00',
                title: '前往京都',
                description: '搭乘 JR Haruka 特急列車 (Hello Kitty 列車) 直接前往京都車站。',
                type: ActivityType.TRANSPORT,
                location: 'Kyoto Station'
              },
              {
                time: '15:30',
                title: '飯店 Check-in',
                description: '入住 Hotel The M’s Kyoto。設計感強烈的現代飯店，位於京都車站附近。',
                type: ActivityType.HOTEL,
                location: "Hotel The M's Kyoto"
              },
              {
                time: '16:10',
                title: '嵐山渡月橋、竹林小徑',
                description: '嵐山最具代表性的景點。走過渡月橋，穿梭在竹林小徑中感受京都的寧靜。',
                type: ActivityType.ATTRACTION,
                location: 'Arashiyama Bamboo Grove',
                price: '免費'
              },
              {
                time: '18:00',
                title: '嵐山月燈路',
                description: '秋季限定活動。夜晚的嵐山點亮燈光，竹林與橋樑呈現與白天截然不同的夢幻氛圍。',
                type: ActivityType.ATTRACTION,
                location: 'Arashiyama Park'
              },
              {
                time: '19:30',
                title: '晚餐 / 休息',
                description: '於嵐山周邊享用晚餐，或返回京都車站拉麵小路用餐後回飯店。',
                type: ActivityType.FOOD
              }
            ]
          },
          {
            day: 2,
            date: '10/17 (五)',
            title: '古都風情：清水寺＋八坂神社',
            weather: { temp: '15°C - 23°C', condition: 'Cloudy', icon: 'CloudSun' },
            activities: [
              {
                time: '08:30',
                title: '出發',
                description: '搭乘京都市巴士至五条坂下車，開始步行上山。',
                type: ActivityType.TRANSPORT
              },
              {
                time: '09:30',
                title: '清水寺參觀',
                description: '世界遺產清水寺，以「清水舞台」聞名。參拜後沿著三年坂、二年坂散步，街道兩旁充滿日式傳統小店。',
                price: '門票 ¥500',
                type: ActivityType.ATTRACTION,
                location: 'Kiyomizu-dera'
              },
              {
                time: '11:40',
                title: '八坂神社 & 花見小路',
                description: '京都著名的神社，祈求戀愛運。接著前往花見小路，運氣好可能會看到藝妓。',
                price: '免費',
                type: ActivityType.ATTRACTION,
                location: 'Yasaka Shrine'
              },
              {
                time: '13:25',
                title: '錦市場',
                description: '被稱為「京都的廚房」。可以在這裡享用各種漬物、玉子燒、豆乳甜甜圈等小吃。',
                type: ActivityType.FOOD,
                location: 'Nishiki Market'
              },
              {
                time: '15:00',
                title: '四条河原町 / 平安神宮',
                description: '四条河原町是京都最繁華的購物區。若體力允許，可前往平安神宮參觀巨大的紅色鳥居。',
                type: ActivityType.SHOPPING,
                location: 'Heian Shrine'
              },
              {
                time: '18:30',
                title: '晚餐：壽喜燒',
                description: '享用道地的關西風味壽喜燒（三條河原町店）。記得先將肉煎香再加入醬汁。',
                type: ActivityType.FOOD,
                location: 'Sukiyaki Sanjo Kawaramachi'
              },
              {
                time: '傍晚',
                title: '回飯店休息',
                type: ActivityType.HOTEL
              }
            ]
          },
          {
            day: 3,
            date: '10/18 (六)',
            title: '移動日：伏見稻荷＋大阪摩天輪',
            weather: { temp: '16°C - 22°C', condition: 'Cloudy', icon: 'CloudSun' },
            activities: [
              {
                time: '08:30',
                title: '伏見稻荷大社',
                description: '以千本鳥居聞名全球的神社。建議早點到達避開人潮，沿著紅色鳥居隧道步行上山。',
                price: '免費',
                type: ActivityType.ATTRACTION,
                location: 'Fushimi Inari Taisha'
              },
              {
                time: '11:00',
                title: '午餐 & 取行李',
                description: '在伏見附近用餐，隨後回飯店領取寄放的行李，準備前往大阪。',
                type: ActivityType.FOOD
              },
              {
                time: '14:20',
                title: '前往大阪',
                description: '搭乘 JR 新快速列車前往大阪站 (梅田)。車程約 30 分鐘。',
                type: ActivityType.TRANSPORT
              },
              {
                time: '15:30',
                title: 'HEP FIVE 摩天輪',
                description: '位於梅田的紅色大摩天輪，可俯瞰大阪市景。',
                note: '維修中，請事前確認開放狀況',
                type: ActivityType.ATTRACTION,
                location: 'HEP FIVE Ferris Wheel'
              },
              {
                time: '17:00',
                title: '大阪飯店 Check-in',
                description: '入住 The Bridge Hotel 心齋橋。飯店提供豐富的免費服務（如拉麵宵夜、飲料暢飲）。',
                type: ActivityType.HOTEL,
                location: 'The Bridge Hotel Shinsaibashi'
              },
              {
                time: '18:30',
                title: '道頓堀 & 心齋橋',
                description: '大阪最熱鬧的區域。必拍固力果跑跑人看板，品嚐章魚燒、大阪燒。',
                type: ActivityType.SHOPPING,
                location: 'Dotonbori'
              }
            ]
          },
          {
            day: 4,
            date: '10/19 (日)',
            title: '大阪深度：大阪城＋今昔館',
            weather: { temp: '17°C - 24°C', condition: 'Sunny', icon: 'Sun' },
            activities: [
              {
                time: '08:30',
                title: '前往大阪城',
                description: '搭乘地鐵長堀鶴見綠地線至大阪商務園區站。',
                type: ActivityType.TRANSPORT
              },
              {
                time: '09:00',
                title: '大阪城公園',
                description: '參觀壯麗的大阪城天守閣。使用周遊卷可免費搭乘御座船，並參觀海洋堂公仔博物館。',
                price: '周遊卷',
                type: ActivityType.ATTRACTION,
                location: 'Osaka Castle'
              },
              {
                time: '12:00',
                title: '大阪天滿宮',
                description: '祭祀學問之神菅原道真，是祈求學業進步的聖地。',
                price: '免費',
                type: ActivityType.ATTRACTION,
                location: 'Ōsaka Temmangū'
              },
              {
                time: '12:30',
                title: '天神橋筋商店街',
                description: '日本最長的商店街，充滿庶民風情，午餐選擇豐富。',
                type: ActivityType.FOOD,
                location: 'Tenjinbashisuji Shopping Street'
              },
              {
                time: '13:30',
                title: '大阪生活今昔館',
                description: '室內重現江戶時代的大阪街道，隨著燈光變化體驗日夜轉換，還可便宜體驗和服。',
                price: '周遊卷',
                type: ActivityType.ATTRACTION,
                location: 'Osaka Museum of Housing and Living'
              },
              {
                time: '15:30',
                title: '黑門市場',
                description: '大阪的廚房。推薦嘗試烤扇貝、海膽、和牛串燒以及水果大福。',
                type: ActivityType.FOOD,
                location: 'Kuromon Ichiba Market'
              },
              {
                time: '17:00',
                title: '逛街',
                description: '回心齋橋／道頓堀繼續補貨購物。',
                type: ActivityType.SHOPPING
              },
              {
                time: '20:00',
                title: '燒肉晚餐',
                description: '前往「燒肉力丸」難波道頓堀店享用燒肉吃到飽。',
                type: ActivityType.FOOD,
                location: 'Rikimaru Namba Dotonbori'
              }
            ]
          },
          {
            day: 5,
            date: '10/20 (一)',
            title: '大鳥大社參拜＋返台',
            weather: { temp: '16°C - 23°C', condition: 'Sunny', icon: 'Sun' },
            activities: [
              {
                time: '08:30',
                title: '前往鳳站',
                description: '搭乘地鐵至天王寺站，轉乘 JR 阪和線至鳳站。',
                type: ActivityType.TRANSPORT
              },
              {
                time: '09:20',
                title: '大鳥大社',
                description: '和泉國一之宮，環境清幽。日本武尊死後化身為白鳥飛至此地的傳說之地。',
                price: '免費',
                type: ActivityType.ATTRACTION,
                location: 'Otori Taisha'
              },
              {
                time: '10:00',
                title: '前往機場',
                description: '搭乘 JR 或 南海電鐵前往關西機場。',
                type: ActivityType.TRANSPORT
              },
              {
                time: '11:00',
                title: '機場報到',
                description: '辦理登機報到、行李托運。之後可辦理退稅並享用最後的日本午餐。',
                type: ActivityType.OTHER,
                location: 'Kansai International Airport'
              },
              {
                time: '14:00',
                title: '搭機返台',
                description: '搭乘中華航空 CI0153 返回溫暖的家。',
                type: ActivityType.FLIGHT
              }
            ]
          }
        ]
      };

      // --- Components ---

      const WeatherWidget = ({ weather }) => {
        if (!weather) return null;
        const Icon = weather.icon === 'Sun' ? Sun : (weather.icon === 'CloudRain' ? CloudRain : CloudSun);
        
        return (
          <div className="flex items-center gap-3 bg-gradient-to-br from-blue-900/40 to-slate-800/40 border border-white/10 rounded-xl p-3 mb-4 backdrop-blur-sm">
             <div className="p-2 bg-yellow-400/20 rounded-full">
                <Icon size={20} className="text-yellow-400" />
             </div>
             <div>
                <p className="text-xs text-slate-400 font-medium uppercase tracking-wider">Forecast</p>
                <p className="text-sm font-bold text-white">{weather.condition} • {weather.temp}</p>
             </div>
          </div>
        );
      };

      const CurrencyConverter = () => {
        const [amount, setAmount] = useState('');
        const rate = 0.22; // Hardcoded estimate
        
        return (
          <div className="bg-slate-800/50 p-4 rounded-xl border border-white/10 space-y-3">
             <h3 className="text-sm font-bold text-slate-300 flex items-center gap-2">
                <Calculator size={14} /> 匯率試算 (約 0.22)
             </h3>
             <div className="flex gap-2 items-center">
                <div className="relative flex-1">
                   <input 
                      type="number" 
                      value={amount}
                      onChange={(e) => setAmount(e.target.value)}
                      placeholder="日幣"
                      className="w-full bg-slate-900 border border-slate-700 rounded-lg py-2 px-3 text-white placeholder-slate-600 focus:outline-none focus:border-blue-500"
                   />
                   <span className="absolute right-3 top-2 text-slate-500 text-xs font-bold">JPY</span>
                </div>
                <span className="text-slate-500">=</span>
                <div className="relative flex-1">
                   <div className="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg py-2 px-3 text-blue-400 font-bold">
                      {amount ? Math.round(amount * rate).toLocaleString() : '0'}
                   </div>
                   <span className="absolute right-3 top-2 text-slate-500 text-xs font-bold">TWD</span>
                </div>
             </div>
          </div>
        );
      };

      const ToolsDrawer = ({ isOpen, onClose }) => {
        if (!isOpen) return null;
        
        return (
          <div className="fixed inset-0 z-50 flex items-end justify-center sm:items-center">
            <div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={onClose} />
            <div className="relative w-full max-w-md bg-slate-900 sm:rounded-2xl rounded-t-2xl border-t sm:border border-white/10 p-5 space-y-6 animate-slideUp">
               <div className="flex items-center justify-between mb-2">
                  <h2 className="text-xl font-bold text-white">旅遊工具箱</h2>
                  <button onClick={onClose} className="p-2 bg-slate-800 rounded-full text-slate-400 hover:text-white">
                    <X size={20} />
                  </button>
               </div>
               
               <CurrencyConverter />
               
               <div className="grid grid-cols-2 gap-3">
                  <a href="https://translate.google.com/" target="_blank" className="flex flex-col items-center justify-center p-4 bg-slate-800 rounded-xl border border-white/5 active:bg-slate-700">
                     <RefreshCw size={24} className="text-green-400 mb-2" />
                     <span className="text-sm font-medium text-slate-300">翻譯</span>
                  </a>
                  <a href="https://www.google.com/maps" target="_blank" className="flex flex-col items-center justify-center p-4 bg-slate-800 rounded-xl border border-white/5 active:bg-slate-700">
                     <Map size={24} className="text-blue-400 mb-2" />
                     <span className="text-sm font-medium text-slate-300">地圖</span>
                  </a>
               </div>

               <div className="bg-rose-500/10 border border-rose-500/20 p-4 rounded-xl flex items-start gap-3">
                  <AlertTriangle className="text-rose-500 shrink-0" size={20} />
                  <div>
                    <h4 className="font-bold text-rose-400 text-sm">緊急聯絡 (日本)</h4>
                    <p className="text-slate-400 text-xs mt-1">
                      報警: 110 | 救護車/火警: 119<br/>
                      旅外國人急難救助: 0800-085-095
                    </p>
                  </div>
               </div>
            </div>
          </div>
        );
      };

      const EventModal = ({ isOpen, onClose, activity }) => {
        const [isClosing, setIsClosing] = useState(false);

        useEffect(() => {
          if (isOpen) setIsClosing(false);
        }, [isOpen]);

        const handleClose = () => {
          setIsClosing(true);
          setTimeout(onClose, 200);
        };

        if (!isOpen && !isClosing) return null;
        if (!activity) return null;

        const googleMapsUrl = activity.location
          ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(activity.location)}`
          : null;

        const getHeaderColor = () => {
          switch(activity.type) {
            case ActivityType.ATTRACTION: return 'from-rose-500 to-pink-600';
            case ActivityType.FLIGHT: return 'from-blue-500 to-cyan-500';
            case ActivityType.TRANSPORT: return 'from-indigo-500 to-violet-600';
            case ActivityType.FOOD: return 'from-orange-500 to-amber-500';
            case ActivityType.HOTEL: return 'from-slate-600 to-slate-800';
            case ActivityType.SHOPPING: return 'from-fuchsia-600 to-purple-600';
            default: return 'from-emerald-500 to-teal-600';
          }
        };

        return (
          <div className={`fixed inset-0 z-50 flex items-end sm:items-center justify-center sm:px-4 transition-opacity duration-200 ${isClosing ? 'opacity-0' : 'opacity-100'}`}>
            <div 
              className="absolute inset-0 bg-black/80 backdrop-blur-md" 
              onClick={handleClose}
            />
            <div className={`
              relative w-full max-w-md bg-slate-900 sm:rounded-2xl rounded-t-2xl border border-white/10 shadow-2xl overflow-hidden 
              transform transition-transform duration-300
              ${isClosing ? 'translate-y-full sm:scale-95' : 'translate-y-0 sm:scale-100'}
            `}>
              {/* Header */}
              <div className={`bg-gradient-to-r ${getHeaderColor()} p-6 text-white relative`}>
                <button 
                  onClick={handleClose}
                  className="absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition-colors"
                >
                  <X size={20} />
                </button>
                <div className="mt-2">
                  <div className="inline-flex items-center gap-1 px-2.5 py-1 text-xs font-bold bg-black/20 rounded-full mb-3 backdrop-blur-sm border border-white/10 shadow-sm">
                    <Clock size={12} />
                    {activity.time}
                  </div>
                  <h3 className="text-2xl font-bold leading-tight pr-6 drop-shadow-md">{activity.title}</h3>
                </div>
              </div>

              {/* Body */}
              <div className="p-6 space-y-6 max-h-[60vh] overflow-y-auto overscroll-contain bg-slate-900">
                {activity.description && (
                  <div className="flex items-start gap-4">
                    <div className="p-2 bg-slate-800 rounded-lg shrink-0 border border-white/5">
                      <Info className="w-5 h-5 text-blue-400" />
                    </div>
                    <div className="space-y-1">
                      <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">簡介</span>
                      <p className="text-slate-200 leading-relaxed text-[15px]">{activity.description}</p>
                    </div>
                  </div>
                )}

                {activity.price && (
                  <div className="flex items-center gap-4">
                     <div className="p-2 bg-slate-800 rounded-lg shrink-0 border border-white/5">
                      <Ticket className="w-5 h-5 text-emerald-400" />
                    </div>
                     <div className="space-y-0.5">
                      <span className="text-xs font-bold text-slate-500 uppercase tracking-wide">費用</span>
                      <p className="text-slate-200 font-medium text-[15px]">{activity.price}</p>
                    </div>
                  </div>
                )}

                {activity.note && (
                  <div className="flex items-start gap-3 bg-amber-500/10 p-4 rounded-xl border border-amber-500/20">
                    <AlertTriangle className="w-5 h-5 text-amber-500 mt-0.5 shrink-0" />
                    <p className="text-sm text-amber-200 font-medium leading-relaxed">{activity.note}</p>
                  </div>
                )}

                {activity.location && (
                  <div className="flex items-center gap-4">
                     <div className="p-2 bg-slate-800 rounded-lg shrink-0 border border-white/5">
                      <MapPin className="w-5 h-5 text-rose-400" />
                    </div>
                    <span className="text-slate-300 font-medium text-sm truncate">{activity.location}</span>
                  </div>
                )}
              </div>

              {/* Footer */}
              <div className="p-6 pt-4 pb-8 safe-bottom bg-slate-900 border-t border-white/5">
                {googleMapsUrl ? (
                  <a
                    href={googleMapsUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="flex items-center justify-center gap-2 w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98] shadow-lg shadow-blue-900/50"
                  >
                    <MapPin size={18} />
                    開啟 Google Maps
                  </a>
                ) : (
                   <button
                    onClick={handleClose}
                    className="flex items-center justify-center w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98] border border-white/5"
                  >
                    關閉
                  </button>
                )}
              </div>
            </div>
          </div>
        );
      };

      const Timeline = ({ activities, onSelectActivity }) => {
        const getIcon = (type) => {
          switch (type) {
            case ActivityType.FLIGHT: return <Plane size={18} />;
            case ActivityType.TRANSPORT: return <Train size={18} />;
            case ActivityType.HOTEL: return <BedDouble size={18} />;
            case ActivityType.ATTRACTION: return <Camera size={18} />;
            case ActivityType.FOOD: return <Utensils size={18} />;
            case ActivityType.SHOPPING: return <ShoppingBag size={18} />;
            default: return <MapPin size={18} />;
          }
        };

        const getColors = (type) => {
          switch (type) {
            case ActivityType.FLIGHT: return 'bg-blue-500/10 text-blue-400 border-blue-500/20';
            case ActivityType.TRANSPORT: return 'bg-indigo-500/10 text-indigo-400 border-indigo-500/20';
            case ActivityType.HOTEL: return 'bg-slate-700/30 text-slate-300 border-slate-600/30';
            case ActivityType.ATTRACTION: return 'bg-rose-500/10 text-rose-400 border-rose-500/20';
            case ActivityType.FOOD: return 'bg-orange-500/10 text-orange-400 border-orange-500/20';
            case ActivityType.SHOPPING: return 'bg-fuchsia-500/10 text-fuchsia-400 border-fuchsia-500/20';
            default: return 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20';
          }
        };

        return (
          <div className="relative pl-6 space-y-6 pb-32">
            {/* Vertical Line */}
            <div className="absolute left-[23px] top-4 bottom-0 w-[2px] bg-slate-800 rounded-full" />
            
            {activities.map((activity, index) => {
              const colors = getColors(activity.type);
              return (
                <div 
                  key={index} 
                  className="relative flex gap-4 group cursor-pointer animate-fadeIn"
                  style={{ animationDelay: `${index * 50}ms` }}
                  onClick={() => onSelectActivity(activity)}
                >
                  {/* Timeline Dot */}
                  <div className={`
                    relative z-10 flex items-center justify-center w-12 h-12 rounded-xl shrink-0 
                    bg-slate-900 border transition-transform group-active:scale-95 shadow-lg shadow-black/20
                    ${colors}
                  `}>
                    {getIcon(activity.type)}
                  </div>

                  {/* Card */}
                  <div className="flex-1 glass-card rounded-xl p-4 active:bg-slate-800/80 transition-all active:scale-[0.99]">
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center gap-1.5 text-[11px] font-bold text-slate-400 bg-slate-800/50 px-2 py-1 rounded-md border border-white/5">
                        <Clock size={10} />
                        {activity.time}
                      </div>
                      {activity.type === ActivityType.ATTRACTION && <span className="w-1.5 h-1.5 rounded-full bg-rose-500 shadow-[0_0_8px_rgba(244,63,94,0.6)]"></span>}
                    </div>
                    <h3 className="font-bold text-slate-100 text-[16px] mb-1.5 leading-tight">{activity.title}</h3>
                    {activity.description && (
                      <p className="text-slate-400 text-xs leading-relaxed line-clamp-2">{activity.description}</p>
                    )}
                    {activity.note && (
                      <p className="text-amber-400/90 text-[10px] mt-2 font-medium flex items-center gap-1.5 bg-amber-900/20 inline-block px-2 py-1 rounded border border-amber-500/10">
                         <AlertTriangle size={10} /> {activity.note}
                      </p>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        );
      };

      const InfoSection = ({ data }) => {
        const [isOpen, setIsOpen] = useState(false);
        return (
          <div className="bg-slate-800/40 rounded-xl border border-white/5 overflow-hidden mb-6 transition-all">
            <button 
              onClick={() => setIsOpen(!isOpen)}
              className="w-full flex items-center justify-between p-4 bg-gradient-to-r from-blue-900/20 to-transparent hover:from-blue-900/30 transition-all"
            >
              <div className="flex items-center gap-3">
                <div className="bg-blue-500/20 p-2 rounded-lg text-blue-400 ring-1 ring-blue-500/30">
                  <Plane size={18} />
                </div>
                <div className="text-left">
                  <span className="block font-bold text-slate-200 text-sm">航班與住宿資訊</span>
                  <span className="text-[10px] text-slate-500 uppercase tracking-wider">Tap to expand</span>
                </div>
              </div>
              {isOpen ? <ChevronUp size={18} className="text-slate-400" /> : <ChevronDown size={18} className="text-slate-400" />}
            </button>
            
            {isOpen && (
              <div className="p-4 space-y-5 border-t border-white/5 animate-fadeIn bg-slate-900/30">
                {/* Outbound */}
                <div className="relative pl-2">
                  <div className="absolute left-[7px] top-8 bottom-0 w-0.5 bg-slate-700"></div>
                  <div className="flex gap-4 mb-4">
                    <div className="w-4 h-4 rounded-full bg-slate-900 border-2 border-blue-500 shrink-0 mt-1 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
                    <div>
                      <h4 className="text-[10px] font-bold text-slate-500 uppercase mb-0.5">去程 (10/16)</h4>
                      <div className="text-sm font-bold text-white">{data.flights.outbound.flightNumber}</div>
                      <div className="text-xs text-slate-400 mt-1">
                        {data.flights.outbound.departureTime} {data.flights.outbound.departureAirport}
                        <br/>
                        <span className="text-slate-600">↓</span>
                        <br/>
                        {data.flights.outbound.arrivalTime} {data.flights.outbound.arrivalAirport}
                      </div>
                    </div>
                  </div>
                  
                  {/* Inbound */}
                   <div className="flex gap-4">
                    <div className="w-4 h-4 rounded-full bg-slate-900 border-2 border-blue-500 shrink-0 mt-1 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
                    <div>
                      <h4 className="text-[10px] font-bold text-slate-500 uppercase mb-0.5">回程 (10/20)</h4>
                      <div className="text-sm font-bold text-white">{data.flights.inbound.flightNumber}</div>
                      <div className="text-xs text-slate-400 mt-1">
                        {data.flights.inbound.departureTime} {data.flights.inbound.departureAirport}
                        <br/>
                        <span className="text-slate-600">↓</span>
                        <br/>
                        {data.flights.inbound.arrivalTime} {data.flights.inbound.arrivalAirport}
                      </div>
                    </div>
                  </div>
                </div>

                <div className="h-px bg-white/5" />

                {/* Hotels */}
                <div>
                  <h4 className="text-[10px] font-bold text-slate-500 uppercase mb-3 flex items-center gap-2">
                    <Building size={12} /> 住宿安排
                  </h4>
                  <div className="grid grid-cols-1 gap-2">
                    <div className="bg-slate-800 p-3 rounded-lg border border-white/5">
                      <span className="text-[10px] font-bold text-slate-500 block mb-1 uppercase tracking-wider">京都 (Day 1-2)</span>
                      <span className="font-bold text-slate-200 text-xs">{data.hotels.kyoto}</span>
                    </div>
                    <div className="bg-slate-800 p-3 rounded-lg border border-white/5">
                      <span className="text-[10px] font-bold text-slate-500 block mb-1 uppercase tracking-wider">大阪 (Day 3-4)</span>
                      <span className="font-bold text-slate-200 text-xs">{data.hotels.osaka}</span>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      };

      const App = () => {
        const [activeDay, setActiveDay] = useState(1);
        const [selectedActivity, setSelectedActivity] = useState(null);
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [isToolsOpen, setIsToolsOpen] = useState(false);
        const scrollContainerRef = useRef(null);

        useEffect(() => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }, [activeDay]);

        useEffect(() => {
          if (scrollContainerRef.current) {
             const activeTab = scrollContainerRef.current.children[activeDay - 1];
             if (activeTab) {
               const containerLeft = scrollContainerRef.current.offsetLeft;
               const activeTabLeft = activeTab.offsetLeft;
               const scrollAmount = activeTabLeft - containerLeft - 20; 
               scrollContainerRef.current.scrollTo({ left: scrollAmount, behavior: 'smooth' });
             }
          }
        }, [activeDay]);

        const handleActivityClick = (activity) => {
          setSelectedActivity(activity);
          setIsModalOpen(true);
        };

        const currentItinerary = TRIP_DATA.itinerary.find(d => d.day === activeDay);

        return (
          <div className="min-h-screen font-sans max-w-[500px] mx-auto shadow-2xl shadow-black relative bg-[#0f172a]">
            {/* Header */}
            <header className="glass sticky top-0 z-30 pt-safe-top">
              <div className="px-5 py-3 flex items-center justify-between">
                <div>
                  <h1 className="text-lg font-black text-white flex items-center gap-2 tracking-tight">
                    <Map className="text-rose-500 fill-rose-500" size={18} />
                    KYOTO & OSAKA
                  </h1>
                  <p className="text-[10px] text-slate-400 font-medium ml-[26px] tracking-wide uppercase">Family Trip 2025</p>
                </div>
                <button onClick={() => setIsToolsOpen(true)} className="p-2 bg-slate-800 rounded-full text-slate-300 hover:bg-slate-700 active:scale-95 transition-all border border-white/5">
                  <Calculator size={18} />
                </button>
              </div>

              {/* Tabs */}
              <div 
                ref={scrollContainerRef}
                className="overflow-x-auto no-scrollbar flex px-4 pb-0 snap-x"
              >
                {TRIP_DATA.itinerary.map((day) => (
                  <button
                    key={day.day}
                    onClick={() => setActiveDay(day.day)}
                    className={`
                      flex flex-col items-center pt-3 pb-3 px-1 min-w-[72px] relative snap-start
                      transition-colors outline-none
                    `}
                  >
                    <span className={`text-[10px] font-bold uppercase mb-1 ${activeDay === day.day ? 'text-rose-400' : 'text-slate-500'}`}>
                      Day {day.day}
                    </span>
                    <span className={`text-sm font-bold whitespace-nowrap ${activeDay === day.day ? 'text-white' : 'text-slate-500'}`}>
                      {day.date.split(' ')[0]}
                    </span>
                    {activeDay === day.day && (
                      <div className="absolute bottom-0 left-3 right-3 h-[3px] bg-rose-500 rounded-t-full shadow-[0_-2px_8px_rgba(244,63,94,0.5)]" />
                    )}
                  </button>
                ))}
              </div>
            </header>

            {/* Main Content */}
            <main className="px-4 pt-6 safe-bottom">
              
              <WeatherWidget weather={currentItinerary?.weather} />

              <InfoSection data={TRIP_DATA} />
              
              <div className="mb-4 animate-fadeIn px-1">
                <div className="flex items-center gap-2 text-rose-500 mb-2">
                  <Calendar size={14} className="text-rose-500" />
                  <span className="text-[10px] font-bold tracking-[0.2em] uppercase text-rose-500">Timeline</span>
                </div>
                <h2 className="text-xl font-bold text-white leading-tight mb-1">
                  {currentItinerary?.title.split('：')[0]}
                </h2>
                <p className="text-slate-400 text-sm font-medium">{currentItinerary?.title.split('：')[1] || currentItinerary?.title}</p>
              </div>

              {currentItinerary && (
                <Timeline 
                  activities={currentItinerary.activities} 
                  onSelectActivity={handleActivityClick}
                />
              )}
            </main>

            <EventModal 
              isOpen={isModalOpen} 
              onClose={() => setIsModalOpen(false)} 
              activity={selectedActivity} 
            />

            <ToolsDrawer 
              isOpen={isToolsOpen}
              onClose={() => setIsToolsOpen(false)}
            />
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
