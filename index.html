<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>京都大阪精緻旅遊手冊</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'wood-dark': '#1A1614',   // 深黑檀木色 (背景)
              'wood-card': '#26201B',   // 深胡桃木色 (卡片)
              'wood-light': '#3E342B',  // 淺木色 (邊框)
              'wood-accent': '#C5A065', // 古銅金 (強調色)
              'wood-text': '#EAE0D5',   // 奶油砂色 (文字)
              'wood-muted': '#9A8C7D',  // 灰褐色 (次要文字)
            },
            fontFamily: {
              sans: ['Noto Sans TC', 'sans-serif'],
              serif: ['Playfair Display', 'serif'],
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-out',
              'slide-up': 'slideUp 0.5s ease-out',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              slideUp: {
                '0%': { transform: 'translateY(20px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              }
            }
          }
        }
      }
    </script>
    
    <!-- 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- 自訂樣式 -->
    <style>
      body {
        font-family: 'Noto Sans TC', sans-serif;
        background-color: #1A1614;
        color: #EAE0D5;
      }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      
      .custom-scrollbar::-webkit-scrollbar { width: 6px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: #1A1614; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #3E342B; border-radius: 3px; }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #C5A065; }
      
      .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    </style>

    <!-- React & Babel (讓瀏覽器看得懂 React) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Import Map: 告訴瀏覽器去哪裡抓套件 -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0",
    "@google/genai": "https://esm.sh/@google/genai",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <!-- 主程式邏輯 -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            CloudSun, Plane, Hotel, Coins, CheckCircle2, MapPin, X, 
            Utensils, Train, Camera, ShoppingBag, Home, Info, 
            MessageCircle, Send, Sparkles, Map, Loader2 
        } from 'lucide-react';
        import { GoogleGenAI } from "@google/genai";

        // ==========================================
        // ⚠️ 請在這裡貼上您的 Google Gemini API Key
        // ==========================================
        const API_KEY = "AIzaSyCpomsc_YHhgkmqjgHI4z5Q9yfC_9QoFzw"; // 範例: "AIzaSy..."
        // ==========================================

        // --- 資料設定 (Constants) ---
        const FLIGHTS = [
            { airline: '中華航空', flightNo: 'CI0152', date: '10/16 (四)', route: 'TPE (桃園) -> KIX (關西)', dep: '09:00', arr: '12:50' },
            { airline: '中華航空', flightNo: 'CI0153', date: '10/20 (一)', route: 'KIX (關西) -> TPE (桃園)', dep: '14:00', arr: '15:55' }
        ];

        const PREPARATION_LIST = [
            { title: "護照", desc: "檢查有效期限是否超過 6 個月。" },
            { title: "Visit Japan Web", desc: "提前填寫入境審查與海關申報，截圖 QR Code。" },
            { title: "日幣現金", desc: "建議攜帶約 ¥50,000 - ¥80,000 / 人 (視購物需求)。" },
            { title: "網卡 / Roaming", desc: "確認 SIM 卡或漫遊已開通。" },
            { title: "交通卡 (ICOCA/Suica)", desc: "加入 Apple Pay 或準備實體卡。" },
            { title: "充電設備", desc: "行動電源、充電線 (日本電壓 100V，插座與台灣相同)。" },
            { title: "常備藥品", desc: "感冒藥、腸胃藥、止痛藥、OK繃。" }
        ];

        const ITINERARY = [
            {
                id: 'day1', date: '10/16 (四)', title: '第一天：京都初印象',
                items: [
                { time: '05:30', title: '出發前往機場', location: '竹北 -> 桃機2航廈', type: 'transport', cost: '現金 1500', description: '準時出發，檢查護照、日幣、網卡。', imageUrl: 'https://images.unsplash.com/photo-1542296332-2e44a996aa0d?auto=format&fit=crop&w=800&q=80' },
                { time: '09:00', title: '搭乘班機 CI0152', location: '桃園國際機場', type: 'flight', description: '飛往關西國際機場 (KIX)。', imageUrl: 'https://images.unsplash.com/photo-1556382363-8967ac2b3548?auto=format&fit=crop&w=800&q=80' },
                { time: '13:00', title: '抵達關西機場', location: 'KIX', type: 'transport', description: '辦理入境手續，領取行李。', imageUrl: 'https://images.unsplash.com/photo-1626359518041-3b56247c1706?auto=format&fit=crop&w=800&q=80' },
                { time: '14:00', title: '搭乘 Haruka 特急', location: '關西機場 -> 京都車站', type: 'transport', description: '使用 JR Pass 或預購票券，約 75 分鐘車程。', imageUrl: 'https://images.unsplash.com/photo-1533036814668-3e913a80db63?auto=format&fit=crop&w=800&q=80' },
                { time: '15:30', title: '飯店 Check-in', location: "Hotel The M’s Kyoto", type: 'hotel', mapQuery: "Hotel The M’s Kyoto", description: '時尚設計風格飯店，位於京都車站附近，交通便利。', imageUrl: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?auto=format&fit=crop&w=800&q=80' },
                { time: '16:10', title: '嵐山渡月橋、竹林小徑', location: '嵐山', type: 'activity', cost: '免費', mapQuery: 'Arashiyama Bamboo Grove', description: '京都必訪景點，感受竹林幽靜與渡月橋的開闊。', imageUrl: 'https://images.unsplash.com/photo-1528164344705-47542687000d?auto=format&fit=crop&w=800&q=80' },
                { time: '18:00', title: '嵐山月燈路', location: '嵐山', type: 'activity', description: '欣賞夜晚的燈光藝術（季節限定活動）。', imageUrl: 'https://images.unsplash.com/photo-1576485290814-1c72aa4bbb8e?auto=format&fit=crop&w=800&q=80' },
                { time: '19:30', title: '晚餐 / 休息', location: '京都車站周邊', type: 'food', description: '返回飯店附近享用晚餐。', imageUrl: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800&q=80' }
                ]
            },
            {
                id: 'day2', date: '10/17 (五)', title: '第二天：古都風情',
                items: [
                { time: '08:30', title: '飯店出發', location: '前往五条坂', type: 'transport', description: '搭乘市巴士前往清水寺區域。', imageUrl: 'https://images.unsplash.com/photo-1624523311893-61db078cb427?auto=format&fit=crop&w=800&q=80' },
                { time: '09:30', title: '清水寺 & 二三年坂', location: '清水寺', type: 'activity', cost: '門票 ¥500', mapQuery: 'Kiyomizu-dera', description: '世界遺產清水舞台，求姻緣的地主神社，漫步古色古香的坂道。', imageUrl: 'https://images.unsplash.com/photo-1545569341-9eb8b30979d9?auto=format&fit=crop&w=800&q=80' },
                { time: '11:40', title: '八坂神社 & 花見小路', location: '八坂神社', type: 'activity', cost: '免費', mapQuery: 'Yasaka Shrine', description: '京都祇園的守護神社，接著漫步花見小路尋找藝妓身影。', imageUrl: 'https://images.unsplash.com/photo-1599406567151-50e41d8e8549?auto=format&fit=crop&w=800&q=80' },
                { time: '13:25', title: '錦市場午餐', location: '錦市場', type: 'food', mapQuery: 'Nishiki Market', description: '「京都的廚房」，品嚐玉子燒、豆乳甜甜圈等小吃。', imageUrl: 'https://images.unsplash.com/photo-1583244532610-2a234e7c3eca?auto=format&fit=crop&w=800&q=80' },
                { time: '15:00', title: '四条河原町 / 平安神宮', location: '四条河原町', type: 'shopping', description: '自由逛街購物，或前往平安神宮參觀（本殿免費）。', mapQuery: 'Heian Shrine', imageUrl: 'https://images.unsplash.com/photo-1506509018519-798836541e2e?auto=format&fit=crop&w=800&q=80' },
                { time: '18:30', title: '壽喜燒晚餐', location: '壽喜燒三條河原町店', type: 'food', description: '享受道地的關西壽喜燒。', imageUrl: 'https://images.unsplash.com/photo-1549608276-5786777e6587?auto=format&fit=crop&w=800&q=80' },
                ]
            },
            {
                id: 'day3', date: '10/18 (六)', title: '第三天：移動至大阪',
                items: [
                { time: '08:30', title: '伏見稻荷大社', location: '伏見稻荷大社', type: 'activity', cost: '免費', mapQuery: 'Fushimi Inari Taisha', description: '壯觀的千本鳥居，狐狸使者的守護地。', imageUrl: 'https://images.unsplash.com/photo-1478436127897-769e1b3f0f36?auto=format&fit=crop&w=800&q=80' },
                { time: '11:00', title: '午餐 & 取行李', location: '京都', type: 'food', imageUrl: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800&q=80' },
                { time: '14:20', title: '搭 JR 新快速往大阪', location: '京都 -> 大阪', type: 'transport', imageUrl: 'https://images.unsplash.com/photo-1533036814668-3e913a80db63?auto=format&fit=crop&w=800&q=80' },
                { time: '15:30', title: '梅田 HEP FIVE 摩天輪', location: 'HEP FIVE', type: 'activity', description: '大阪地標紅色摩天輪（注意：行程表註記維修中，請確認現場狀況）。', mapQuery: 'HEP FIVE Ferris Wheel', imageUrl: 'https://images.unsplash.com/photo-1601051515286-63e8df3111f1?auto=format&fit=crop&w=800&q=80' },
                { time: '17:00', title: '飯店 Check-in', location: 'The Bridge Hotel Shinsaibashi', type: 'hotel', mapQuery: 'The Bridge Hotel Shinsaibashi', description: '位於心齋橋中心，每晚提供免費拉麵宵夜與啤酒暢飲。', imageUrl: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&w=800&q=80' },
                { time: '18:30', title: '道頓堀 & 心齋橋', location: '道頓堀', type: 'shopping', mapQuery: 'Dotonbori', description: '跑跑人看板打卡，藥妝店採購，章魚燒、拉麵吃到飽。', imageUrl: 'https://images.unsplash.com/photo-1590559899731-a38283956c8c?auto=format&fit=crop&w=800&q=80' },
                ]
            },
            {
                id: 'day4', date: '10/19 (日)', title: '第四天：大阪深度遊',
                items: [
                { time: '08:30', title: '前往大阪城', location: '地鐵至大阪商務園區', type: 'transport', imageUrl: 'https://images.unsplash.com/photo-1537233863486-1d18721c5770?auto=format&fit=crop&w=800&q=80' },
                { time: '09:00', title: '大阪城 & 御座船', location: '大阪城天守閣', type: 'activity', description: '大阪象徵，豐臣秀吉的居城。', mapQuery: 'Osaka Castle', imageUrl: 'https://images.unsplash.com/photo-1555427104-5f118c7fb391?auto=format&fit=crop&w=800&q=80' },
                { time: '12:00', title: '大阪天滿宮', location: '大阪天滿宮', type: 'activity', cost: '免費', mapQuery: 'Osaka Tenmangu', description: '學問之神菅原道真，祈求學業進步。', imageUrl: 'https://images.unsplash.com/photo-1590252973707-2c938f3cb293?auto=format&fit=crop&w=800&q=80' },
                { time: '12:30', title: '天神橋筋商店街', location: '天神橋筋', type: 'food', mapQuery: 'Tenjinbashi-suji Shopping Street', description: '日本最長的商店街，充滿庶民美食。', imageUrl: 'https://images.unsplash.com/photo-1533050487297-09b450131914?auto=format&fit=crop&w=800&q=80' },
                { time: '13:30', title: '大阪生活今昔館', location: '大阪生活今昔館', type: 'activity', description: '穿越時空回到江戶時代的大阪街道，可體驗和服。', mapQuery: 'Osaka Museum of Housing and Living', imageUrl: 'https://images.unsplash.com/photo-1522883040382-72922187d903?auto=format&fit=crop&w=800&q=80' },
                { time: '15:30', title: '黑門市場', location: '黑門市場', type: 'food', mapQuery: 'Kuromon Ichiba Market', description: '「大阪的廚房」，必吃海鮮、和牛串、水果大福。', imageUrl: 'https://images.unsplash.com/photo-1516475429286-465d815a0df7?auto=format&fit=crop&w=800&q=80' },
                { time: '20:00', title: '燒肉晚餐', location: '燒肉力丸難波道頓堀店', type: 'food', description: '日式燒肉吃到飽。', imageUrl: 'https://images.unsplash.com/photo-1553621042-f6e147245754?auto=format&fit=crop&w=800&q=80' }
                ]
            },
            {
                id: 'day5', date: '10/20 (一)', title: '第五天：參拜與返台',
                items: [
                { time: '08:30', title: '前往大鳥大社', location: '天王寺 -> JR 鳳站', type: 'transport', imageUrl: 'https://images.unsplash.com/photo-1537233863486-1d18721c5770?auto=format&fit=crop&w=800&q=80' },
                { time: '09:20', title: '大鳥大社參拜', location: '大鳥大社', type: 'activity', cost: '免費', mapQuery: 'Otori Taisha', description: '和泉國一之宮，歷史悠久的神社。', imageUrl: 'https://images.unsplash.com/photo-1605218439972-04e4e963fc30?auto=format&fit=crop&w=800&q=80' },
                { time: '10:00', title: '前往關西機場', location: '鳳站 -> KIX', type: 'transport', description: '搭乘 JR 或南海電鐵前往機場。', imageUrl: 'https://images.unsplash.com/photo-1533036814668-3e913a80db63?auto=format&fit=crop&w=800&q=80' },
                { time: '11:00', title: '機場報到', location: 'KIX 第一航廈', type: 'flight', description: '辦理登機、託運、最後免稅品採購。', imageUrl: 'https://images.unsplash.com/photo-1569154941061-e231b4725ef1?auto=format&fit=crop&w=800&q=80' },
                { time: '14:00', title: '搭乘班機 CI0153', location: 'KIX -> TPE', type: 'flight', description: '帶著滿滿的回憶飛往溫暖的家。', imageUrl: 'https://images.unsplash.com/photo-1570710891163-6d3b5c47248b?auto=format&fit=crop&w=800&q=80' },
                ]
            }
        ];

        // --- AI 服務 (Gemini Service) ---
        const ai = API_KEY ? new GoogleGenAI({ apiKey: API_KEY }) : null;
        const descriptionCache = {};

        const getPlaceDescription = async (placeName, location) => {
            if (!ai) return "AI 服務尚未啟用（請設定 API Key 以獲取即時介紹）。";
            const cacheKey = `${placeName}-${location}`;
            if (descriptionCache[cacheKey]) return descriptionCache[cacheKey];

            try {
                const response = await ai.models.generateContent({
                    model: 'gemini-2.5-flash',
                    contents: `請用繁體中文 (台灣用語) 為遊客提供關於「${location} ${placeName}」的迷人、簡短旅遊介紹 (最多 80 字)。重點介紹它的獨特之處。`,
                });
                const text = response.text || "暫無介紹。";
                descriptionCache[cacheKey] = text;
                return text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "無法載入 AI 介紹，請稍後再試。";
            }
        };

        const getTravelAssistantResponse = async (userMessage, context) => {
            if (!ai) return "請設定 API Key 以使用 AI 旅遊助手。";
            try {
                const response = await ai.models.generateContent({
                    model: 'gemini-2.5-flash',
                    contents: userMessage,
                    config: {
                        systemInstruction: `You are a helpful travel assistant for a family trip to Kyoto and Osaka. 
                        Current Itinerary Context: ${context}
                        Answer the user's questions briefly and helpfully in Traditional Chinese (Taiwan).`
                    }
                });
                return response.text || "我現在無法回答，請稍後再試。";
            } catch (e) {
                console.error(e);
                return "連線錯誤。";
            }
        };

        // --- 元件：AttractionModal (景點彈窗) ---
        const AttractionModal = ({ item, onClose }) => {
            const [aiDescription, setAiDescription] = useState(null);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const fetchDesc = async () => {
                    if (item.mapQuery) {
                        setLoading(true);
                        const desc = await getPlaceDescription(item.title, item.location);
                        setAiDescription(desc);
                        setLoading(false);
                    }
                };
                fetchDesc();
            }, [item]);

            const seed = item.title.length * 123; 
            const imageUrl = item.imageUrl || `https://picsum.photos/seed/${seed}/800/600`;
            const googleMapsUrl = item.mapQuery 
                ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.mapQuery)}`
                : null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-wood-dark/95 backdrop-blur-md animate-fade-in" onClick={onClose}>
                    <div className="bg-wood-card border border-wood-light w-full max-w-md overflow-hidden flex flex-col max-h-[90vh] animate-slide-up relative shadow-[0_0_50px_rgba(0,0,0,0.6)]" onClick={(e) => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 right-4 z-10 bg-wood-dark/60 backdrop-blur text-wood-text p-2 rounded-full hover:bg-wood-accent hover:text-wood-dark transition-colors border border-white/10">
                            <X size={20} strokeWidth={1} />
                        </button>
                        <div className="relative h-72 bg-wood-dark shrink-0">
                            <img src={imageUrl} alt={item.title} className="w-full h-full object-cover opacity-90 transition-opacity duration-700 hover:opacity-100"/>
                            <div className="absolute inset-0 bg-gradient-to-t from-wood-card via-transparent to-transparent"></div>
                            <div className="absolute bottom-0 left-0 p-8 w-full">
                                <h3 className="text-3xl font-serif italic text-wood-text tracking-wide mb-2 text-shadow">{item.title}</h3>
                                <p className="text-wood-accent text-xs flex items-center font-medium tracking-[0.2em] uppercase"><MapPin size={12} className="mr-2" /> {item.location}</p>
                            </div>
                        </div>
                        <div className="p-8 overflow-y-auto custom-scrollbar">
                            <div className="mb-10">
                                <span className="block text-[10px] tracking-[0.25em] text-wood-muted mb-4 uppercase border-b border-wood-light/50 pb-2">景點簡介</span>
                                <p className="text-wood-text leading-loose text-sm font-light tracking-wide">{item.description || '暫無詳細說明。'}</p>
                                {item.cost && <div className="mt-5 inline-block text-[10px] text-wood-accent border border-wood-accent/30 px-4 py-1.5 tracking-wider">{item.cost}</div>}
                            </div>
                            <div className="mb-10 p-6 bg-wood-dark/50 border border-wood-light relative">
                                <div className="flex items-center gap-2 mb-4 text-wood-accent">
                                    <Sparkles size={16} strokeWidth={1} />
                                    <h4 className="font-serif italic text-lg tracking-wide">AI 導覽</h4>
                                </div>
                                {loading ? (
                                    <div className="flex items-center text-wood-muted text-xs py-2 tracking-wide"><Loader2 size={16} className="animate-spin mr-3 text-wood-accent" /> 正在查詢資料庫...</div>
                                ) : (
                                    <p className="text-sm text-wood-text/80 leading-loose font-light italic">{aiDescription || '無法取得 AI 資訊。'}</p>
                                )}
                            </div>
                            {googleMapsUrl && (
                                <a href={googleMapsUrl} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center w-full bg-wood-text text-wood-dark py-4 text-xs tracking-[0.25em] hover:bg-wood-accent transition-colors font-medium uppercase">
                                    <Map size={14} className="mr-3" strokeWidth={1.5} />開啟地圖
                                </a>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 元件：InfoTab (資訊頁) ---
        const InfoTab = () => {
            const [yenAmount, setYenAmount] = useState('');
            const [activeModal, setActiveModal] = useState(null);
            const exchangeRate = 0.215;
            const twdAmount = yenAmount ? Math.round(parseFloat(yenAmount) * exchangeRate) : 0;
            const hotels = ITINERARY.flatMap(day => day.items.filter(item => item.type === 'hotel')).filter((item, index, self) => index === self.findIndex((t) => t.location === item.location));

            return (
                <div className="space-y-10 pb-12 animate-fade-in">
                    <div className="text-center pt-4">
                        <div className="inline-flex items-center justify-center border-y border-wood-accent/30 py-1 mb-4 w-24">
                            <span className="text-[10px] tracking-[0.3em] text-wood-accent uppercase">行程總覽</span>
                        </div>
                        <h2 className="text-4xl font-serif italic text-wood-text mb-2">日本五日遊</h2>
                        <p className="text-xs text-wood-muted tracking-[0.2em] font-light">2024.10.16 — 10.20</p>
                    </div>
                    <div className="grid grid-cols-2 gap-5">
                        <button onClick={() => setActiveModal('hotel')} className="bg-wood-card border border-wood-light p-6 hover:border-wood-accent hover:shadow-[0_0_15px_rgba(197,160,101,0.1)] transition-all duration-300 group text-left relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity"><Hotel size={48} className="text-wood-text"/></div>
                            <Hotel size={20} strokeWidth={1} className="text-wood-accent mb-4 group-hover:scale-110 transition-transform origin-left" />
                            <span className="block text-sm font-medium tracking-widest text-wood-text mb-1">住宿資訊</span>
                            <span className="text-[10px] text-wood-muted tracking-wide">查看飯店詳情</span>
                        </button>
                        <button onClick={() => setActiveModal('prep')} className="bg-wood-card border border-wood-light p-6 hover:border-wood-accent hover:shadow-[0_0_15px_rgba(197,160,101,0.1)] transition-all duration-300 group text-left relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity"><CheckCircle2 size={48} className="text-wood-text"/></div>
                            <CheckCircle2 size={20} strokeWidth={1} className="text-wood-accent mb-4 group-hover:scale-110 transition-transform origin-left" />
                            <span className="block text-sm font-medium tracking-widest text-wood-text mb-1">行前準備</span>
                            <span className="text-[10px] text-wood-muted tracking-wide">必備清單檢查</span>
                        </button>
                    </div>
                    <div className="bg-wood-card border border-wood-light p-8 relative">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-wood-accent/50 to-transparent opacity-50"></div>
                        <div className="flex items-center gap-3 mb-8">
                            <Coins strokeWidth={1} size={18} className="text-wood-accent"/>
                            <h3 className="font-serif italic text-wood-text tracking-wider text-lg">匯率換算</h3>
                        </div>
                        <div className="flex items-center gap-6">
                            <div className="flex-1">
                                <label className="block text-[10px] text-wood-muted mb-2 uppercase tracking-widest text-center">日圓 (JPY)</label>
                                <input type="number" value={yenAmount} onChange={(e) => setYenAmount(e.target.value)} placeholder="0" className="w-full bg-wood-dark border border-wood-light px-4 py-3 text-xl text-center text-wood-text focus:outline-none focus:border-wood-accent transition-colors placeholder:text-wood-muted/30 font-light"/>
                            </div>
                            <div className="pt-6 text-wood-accent font-serif italic text-xl">兌</div>
                            <div className="flex-1">
                                <label className="block text-[10px] text-wood-muted mb-2 uppercase tracking-widest text-center">台幣 (TWD)</label>
                                <div className="w-full bg-wood-dark/50 border-b border-wood-accent/50 px-4 py-3 text-xl text-center text-wood-text font-medium">${twdAmount.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                    <div className="bg-wood-card border border-wood-light p-6">
                        <div className="flex items-center justify-between mb-6 border-b border-wood-light/50 pb-4">
                            <div className="flex items-center gap-3"><CloudSun strokeWidth={1} size={18} className="text-wood-accent"/><h3 className="font-serif italic text-wood-text tracking-wider text-lg">天氣預報</h3></div>
                            <span className="text-[10px] text-wood-accent border border-wood-accent/30 px-3 py-1 tracking-widest">大阪</span>
                        </div>
                        <div className="grid grid-cols-5 divide-x divide-wood-light/50">
                            {['16', '17', '18', '19', '20'].map((day, idx) => (
                                <div key={idx} className="flex flex-col items-center gap-3 pt-1">
                                    <span className="text-[10px] text-wood-muted font-mono tracking-wider">10/{day}</span>
                                    <CloudSun size={20} strokeWidth={1.5} className={idx < 2 ? "text-wood-accent" : "text-wood-muted"} />
                                    <span className="text-xs font-light text-wood-text tracking-wide">{20 + idx}°</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="space-y-4">
                        <div className="flex items-center gap-3 mb-2 px-1"><Plane strokeWidth={1} size={18} className="text-wood-accent"/><h3 className="font-serif italic text-wood-text tracking-wider text-lg">航班資訊</h3></div>
                        {FLIGHTS.map((flight, idx) => (
                            <div key={idx} className="bg-wood-card border border-wood-light p-6 relative overflow-hidden group">
                                <div className="flex justify-between items-start mb-6">
                                    <div><span className="text-xs font-bold text-wood-accent tracking-[0.2em] uppercase">{flight.airline}</span><div className="text-[10px] text-wood-muted mt-1 font-mono tracking-widest">{flight.flightNo}</div></div>
                                    <div className="text-xs font-mono text-wood-text/80 border border-wood-light px-3 py-1 bg-wood-dark">{flight.date}</div>
                                </div>
                                <div className="flex justify-between items-center relative z-10">
                                    <div><p className="text-3xl font-serif text-wood-text">{flight.dep}</p><p className="text-[10px] text-wood-muted uppercase tracking-[0.2em] mt-2">出發</p></div>
                                    <div className="flex-1 px-6 flex flex-col items-center opacity-50"><div className="w-full h-[1px] bg-wood-text relative"><Plane size={14} className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-wood-text bg-wood-card px-1 rotate-90" /></div></div>
                                    <div className="text-right"><p className="text-3xl font-serif text-wood-text">{flight.arr}</p><p className="text-[10px] text-wood-muted uppercase tracking-[0.2em] mt-2">抵達</p></div>
                                </div>
                            </div>
                        ))}
                    </div>
                    {activeModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-wood-dark/95 backdrop-blur-sm animate-fade-in" onClick={() => setActiveModal(null)}>
                            <div className="bg-wood-card border border-wood-light w-full max-w-sm max-h-[80vh] flex flex-col shadow-[0_0_50px_rgba(0,0,0,0.5)] animate-slide-up" onClick={e => e.stopPropagation()}>
                                <div className="p-6 border-b border-wood-light flex justify-between items-center bg-wood-dark/50">
                                    <h3 className="font-serif italic text-xl text-wood-text flex items-center gap-2 tracking-wide">{activeModal === 'hotel' ? '住宿列表' : '準備清單'}</h3>
                                    <button onClick={() => setActiveModal(null)} className="text-wood-muted hover:text-wood-accent transition-colors"><X size={24} strokeWidth={1} /></button>
                                </div>
                                <div className="p-8 overflow-y-auto space-y-8 custom-scrollbar">
                                    {activeModal === 'hotel' ? hotels.map((hotel, idx) => (
                                        <div key={idx} className="relative pl-6 border-l border-wood-accent">
                                            <h4 className="font-medium text-wood-accent text-lg mb-2 tracking-wide">{hotel.title}</h4>
                                            <div className="flex items-start text-xs text-wood-muted mb-3 gap-2 tracking-wide uppercase"><MapPin size={12} className="mt-0.5 shrink-0" />{hotel.location}</div>
                                            <p className="text-sm text-wood-text/70 leading-relaxed font-light mb-4">{hotel.description}</p>
                                            {hotel.mapQuery && <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(hotel.mapQuery)}`} target="_blank" rel="noopener noreferrer" className="text-[10px] text-wood-text border border-wood-light hover:border-wood-accent hover:text-wood-accent transition-colors px-3 py-1.5 inline-block tracking-widest uppercase">查看地圖</a>}
                                        </div>
                                    )) : PREPARATION_LIST.map((item, idx) => (
                                        <div key={idx} className="flex gap-5 items-start group">
                                            <div className="mt-1 w-3 h-3 border border-wood-muted group-hover:border-wood-accent rotate-45 flex items-center justify-center shrink-0 transition-colors"><div className="w-1.5 h-1.5 bg-wood-accent opacity-0 group-hover:opacity-100 transition-opacity"></div></div>
                                            <div><h4 className="font-medium text-wood-text text-sm mb-1 tracking-wide group-hover:text-wood-accent transition-colors">{item.title}</h4><p className="text-xs text-wood-muted leading-relaxed font-light">{item.desc}</p></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- 元件：DayView (每日行程) ---
        const DayView = ({ schedule }) => {
            const [selectedItem, setSelectedItem] = useState(null);
            const getTypeIcon = (type) => {
                switch (type) {
                    case 'food': return <Utensils size={14} />;
                    case 'transport': return <Train size={14} />;
                    case 'activity': return <Camera size={14} />;
                    case 'shopping': return <ShoppingBag size={14} />;
                    case 'hotel': return <Home size={14} />;
                    default: return <MapPin size={14} />;
                }
            };

            return (
                <div className="pb-24 animate-fade-in">
                    <div className="sticky top-0 z-20 py-6 bg-wood-dark/95 backdrop-blur-md border-b border-wood-light/30 mb-10 -mx-6 px-6">
                        <span className="text-[10px] font-mono text-wood-accent block mb-2 tracking-[0.2em]">{schedule.date}</span>
                        <h2 className="text-2xl font-serif italic text-wood-text tracking-wide">{schedule.title}</h2>
                    </div>
                    <div className="relative pl-2 space-y-10">
                        <div className="absolute left-[19px] top-2 bottom-0 w-[1px] bg-gradient-to-b from-wood-light via-wood-accent/30 to-wood-light"></div>
                        {schedule.items.map((item, index) => {
                            const isClickable = item.mapQuery || item.type === 'activity' || item.type === 'hotel';
                            return (
                                <div key={index} className="relative flex gap-6 group">
                                    <div className="relative z-10 w-10 h-10 bg-wood-dark border border-wood-light flex-shrink-0 flex items-center justify-center text-wood-muted transition-all duration-300 group-hover:border-wood-accent group-hover:text-wood-accent rotate-45 overflow-hidden">
                                        <div className="-rotate-45">{getTypeIcon(item.type)}</div>
                                    </div>
                                    <div onClick={() => isClickable && setSelectedItem(item)} className={`flex-1 bg-wood-card border border-wood-light p-6 relative transition-all duration-300 ${isClickable ? 'cursor-pointer hover:border-wood-accent hover:shadow-[0_4px_20px_rgba(0,0,0,0.3)]' : ''}`}>
                                        <div className="flex justify-between items-baseline mb-3">
                                            <span className="font-mono text-xs text-wood-accent/80 tracking-widest">{item.time}</span>
                                            {item.cost && <span className="text-[10px] text-wood-text/70 border border-wood-light px-2 py-0.5 tracking-wide">{item.cost}</span>}
                                        </div>
                                        <h3 className="font-medium text-lg text-wood-text mb-2 tracking-wide">{item.title}</h3>
                                        <div className="flex items-center text-wood-muted text-xs mb-4 font-light tracking-wide"><MapPin size={12} className="mr-2" /><span className="line-clamp-1">{item.location}</span></div>
                                        {item.description && <div className="text-sm text-wood-text/70 leading-relaxed font-light mt-4 pt-4 border-t border-wood-light/50">{item.description}</div>}
                                        {isClickable && <div className="absolute top-0 right-0 p-3 opacity-0 group-hover:opacity-100 transition-opacity"><div className="w-1.5 h-1.5 bg-wood-accent rounded-full"></div></div>}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {selectedItem && <AttractionModal item={selectedItem} onClose={() => setSelectedItem(null)} />}
                </div>
            );
        };

        // --- 主元件：App ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('info');
            const [showChat, setShowChat] = useState(false);
            const [chatMessage, setChatMessage] = useState("");
            const [chatHistory, setChatHistory] = useState([]);
            const [chatLoading, setChatLoading] = useState(false);

            const handleChatSend = async (e) => {
                e.preventDefault();
                if(!chatMessage.trim()) return;
                const userMsg = chatMessage;
                setChatMessage("");
                setChatHistory(prev => [...prev, {role: 'user', text: userMsg}]);
                setChatLoading(true);
                const context = JSON.stringify(ITINERARY);
                const response = await getTravelAssistantResponse(userMsg, context);
                setChatHistory(prev => [...prev, {role: 'model', text: response}]);
                setChatLoading(false);
            }

            return (
                <div className="max-w-md mx-auto min-h-screen bg-wood-dark relative shadow-[0_0_30px_rgba(0,0,0,0.5)] flex flex-col font-sans border-x border-wood-light">
                    <header className="bg-wood-dark/95 backdrop-blur-md sticky top-0 z-30 pt-10 pb-0 border-b border-wood-light/50">
                        <div className="flex justify-between items-end px-6 mb-6">
                            <div><p className="text-[10px] text-wood-accent tracking-[0.25em] uppercase mb-2 font-medium">專屬旅伴</p><h1 className="text-3xl font-serif italic text-wood-text tracking-wide">京都・大阪</h1></div>
                            <button onClick={() => setShowChat(!showChat)} className="p-3 rounded-full border border-wood-light hover:border-wood-accent text-wood-accent hover:bg-wood-card transition-all duration-300"><MessageCircle strokeWidth={1} size={20} /></button>
                        </div>
                        <div className="flex overflow-x-auto no-scrollbar px-6 gap-8">
                            <button onClick={() => setActiveTab('info')} className={`pb-4 text-xs tracking-[0.15em] whitespace-nowrap transition-all duration-300 relative uppercase font-medium ${activeTab === 'info' ? 'text-wood-accent' : 'text-wood-muted hover:text-wood-text'}`}>
                                <span className="flex items-center gap-2"><Info size={14} strokeWidth={1.5} /> 資訊</span>
                                {activeTab === 'info' && <span className="absolute bottom-0 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-wood-accent shadow-[0_0_8px_#C5A065]"></span>}
                            </button>
                            {ITINERARY.map((day) => (
                                <button key={day.id} onClick={() => setActiveTab(day.id)} className={`pb-4 text-xs tracking-[0.15em] whitespace-nowrap transition-all duration-300 relative uppercase font-medium font-serif ${activeTab === day.id ? 'text-wood-accent' : 'text-wood-muted hover:text-wood-text'}`}>
                                    {day.date.split(' ')[0]}
                                    {activeTab === day.id && <span className="absolute bottom-0 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-wood-accent shadow-[0_0_8px_#C5A065]"></span>}
                                </button>
                            ))}
                        </div>
                    </header>
                    <main className="flex-1 p-6 overflow-y-auto custom-scrollbar">
                        {activeTab === 'info' && <InfoTab />}
                        {ITINERARY.map(day => activeTab === day.id && <DayView key={day.id} schedule={day} />)}
                    </main>
                    {showChat && (
                        <div className="absolute inset-0 z-40 bg-wood-dark/95 backdrop-blur-xl flex flex-col animate-slide-up">
                            <div className="flex items-center justify-between p-6 border-b border-wood-light">
                                <h3 className="font-serif text-lg italic text-wood-text flex items-center gap-3"><MessageCircle size={18} className="text-wood-accent"/> 專屬管家</h3>
                                <button onClick={() => setShowChat(false)} className="text-wood-muted hover:text-wood-accent transition-colors"><X size={24} strokeWidth={1} /></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-6 space-y-6">
                                {chatHistory.length === 0 && (
                                    <div className="text-center mt-24 flex flex-col items-center gap-6 opacity-60">
                                        <div className="w-16 h-16 border border-wood-light rounded-full flex items-center justify-center text-wood-accent bg-wood-card"><MessageCircle size={28} strokeWidth={1} /></div>
                                        <p className="text-wood-text font-serif italic text-lg tracking-wide">請問這趟旅程有什麼需要協助？</p>
                                    </div>
                                )}
                                {chatHistory.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] px-5 py-3.5 text-sm leading-relaxed tracking-wide ${msg.role === 'user' ? 'bg-wood-accent text-wood-dark font-medium' : 'bg-wood-card border border-wood-light text-wood-text'}`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                ))}
                                {chatLoading && <div className="flex justify-start"><div className="bg-wood-card px-4 py-3 border border-wood-light flex gap-1.5"><span className="w-1 h-1 bg-wood-accent rounded-full animate-bounce"></span><span className="w-1 h-1 bg-wood-accent rounded-full animate-bounce delay-100"></span><span className="w-1 h-1 bg-wood-accent rounded-full animate-bounce delay-200"></span></div></div>}
                            </div>
                            <form onSubmit={handleChatSend} className="p-4 border-t border-wood-light bg-wood-dark flex gap-3 pb-8">
                                <input type="text" value={chatMessage} onChange={(e) => setChatMessage(e.target.value)} placeholder="輸入您的問題..." className="flex-1 bg-wood-card border border-wood-light px-4 py-3 text-sm text-wood-text focus:outline-none focus:border-wood-accent transition-colors placeholder:text-wood-muted/50 font-light tracking-wide"/>
                                <button type="submit" disabled={chatLoading} className="bg-wood-accent text-wood-dark w-12 flex items-center justify-center hover:bg-[#D4AF37] transition-colors disabled:opacity-50"><Send size={18} strokeWidth={1.5} /></button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        // --- 啟動應用程式 ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
