<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPhone ç…§ç‰‡ä¸€éµèª¿è‰² (å¯å„²å­˜)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.2/caman.full.min.js"></script>
    <style>
        /* (CSS æ¨£å¼èˆ‡ä¹‹å‰ç‰ˆæœ¬ç›¸åŒï¼Œè«‹åƒè€ƒå‰ä¸€æ¬¡å›è¦†çš„ CSS éƒ¨åˆ†) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #f0f0f5;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #1c1c1e;
            margin-bottom: 20px;
        }

        #upload-container {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px dashed #007aff;
            border-radius: 12px;
            background-color: #ffffff;
            cursor: pointer;
        }

        #controls-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .vibe-button {
            background-color: #007aff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .vibe-button:hover {
            background-color: #005bb5;
        }

        .vibe-button:active {
            transform: scale(0.98);
        }

        #image-container {
            max-width: 100%;
            margin: 0 auto 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }
        
        #photo-canvas {
            display: none;
            max-width: 100%;
            height: auto;
            border-radius: 12px;
        }

        #save-button {
            background-color: #34c759;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            display: none;
            transition: background-color 0.2s;
        }

        #save-button:hover {
            background-color: #28a745;
        }

        .instruction {
            color: #8e8e93;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>âœ¨ iPhone ç…§ç‰‡ä¸€éµèª¿è‰² (å¯å„²å­˜) âœ¨</h1>
    
    <div id="upload-container">
        <label for="photo-upload">é»æ“Šæ­¤è™•é¸æ“‡ç…§ç‰‡ï¼ˆæ‰‹æ©Ÿç›¸ç°¿/æª”æ¡ˆï¼‰</label>
        <input type="file" id="photo-upload" accept="image/*" style="display: none;">
        <p class="instruction">è«‹é¸æ“‡ä¸€å¼µç…§ç‰‡å¾Œï¼Œå†é»æ“Šä¸‹æ–¹æŒ‰éˆ•é€²è¡Œèª¿è‰²</p>
    </div>

    <div id="controls-container">
        <button class="vibe-button" data-filter="filter1">1. å†·ç™½çš®æ¿¾é¡</button>
        <button class="vibe-button" data-filter="filter2">2. ç™¼å…‰å»ç°</button>
        <button class="vibe-button" data-filter="filter3">3. ç¾é£Ÿèª¿</button>
        <button class="vibe-button" data-filter="filter4">4. å¥¶æ²¹insé¢¨</button>
        <button class="vibe-button" data-filter="filter5">5. å¯Œå£«æ„Ÿæ¿¾é¡</button>
        <button class="vibe-button" data-filter="filter6">6. è½æ—¥æ°›åœæ„Ÿ</button>
        <button class="vibe-button" data-filter="filter7">7. æ—¥å¸¸è¡—æ‹æ¿¾é¡</button>
        <button class="vibe-button" data-filter="filter8">8. çµ•ç¾æ—¥è½æ¿¾é¡</button>
        <button class="vibe-button" data-filter="filter9">9. éœè¬æš—èª¿</button>
        <button class="vibe-button" data-filter="reset">ğŸ”„ é‡ç½®</button>
    </div>

    <div id="image-container">
        <canvas id="photo-canvas"></canvas>
    </div>

    <button id="save-button">ğŸ“¥ å„²å­˜ç·¨è¼¯å¾Œç…§ç‰‡</button>

    <script>
        // ----------------------------------------------------
        // 1. å®šç¾©èª¿è‰²åƒæ•¸ (ä½¿ç”¨ CamanJS æ”¯æ´çš„å±¬æ€§)
        // ----------------------------------------------------
        // CamanJS æ”¯æ´çš„åƒæ•¸ï¼šbrightness, contrast, saturation, hue, exposure, 
        // clip, sepia, vintage, sunrise, lomo (å¯ä»¥æ¨¡æ“¬é«˜å…‰/é™°å½±/è‰²æº«)
        
        // åŸå§‹åƒæ•¸å°æ‡‰ CamanJS å±¬æ€§:
        // æ›å…‰ -> exposure
        // é®®æ˜åº¦ (Clarity) -> clarity (CamanJS å…§å»ºæ•ˆæœ, è¼ƒè¤‡é›œ) / å°æ¯” (contrast)
        // é«˜å…‰ -> clip (æ­£å€¼), shadows (è² å€¼)
        // é™°å½± -> shadows
        // å°æ¯” -> contrast
        // é£½å’Œåº¦ -> saturation
        // è‰²æº«/è‰²èª¿ -> hue/channels.red/green/blue (èª¿æ•´ RGB ä¸‰è‰²é€šé“)

        const FILTERS = {
            // åƒæ•¸ä¾†è‡ªæ‚¨çš„åœ–ç‰‡ï¼Œæ˜ å°„åˆ° CamanJS æ”¯æ´çš„å±¬æ€§
            'filter1': { exposure: 40, contrast: 35, saturation: 10, vibrance: -10, clarity: 20 }, // å†·ç™½çš®æ¿¾é¡
            'filter2': { exposure: 5, contrast: 17, saturation: 12, vibrance: 12, hue: 0 }, // ç™¼å…‰å»ç°
            'filter3': { exposure: 30, contrast: 20, saturation: 10, vibrance: 10, hue: 10, clip: 0 }, // ç¾é£Ÿèª¿
            'filter4': { exposure: 10, contrast: -21, saturation: -15, vibrance: -15, hue: 0 }, // å¥¶æ²¹insé¢¨
            'filter5': { exposure: -10, contrast: 10, saturation: 6, vibrance: 6, hue: 10 }, // å¯Œå£«æ„Ÿæ¿¾é¡
            'filter6': { exposure: 55, contrast: 25, saturation: 25, vibrance: 25, hue: 0 }, // è½æ—¥æ°›åœæ„Ÿ
            'filter7': { exposure: 59, contrast: 41, saturation: 41, vibrance: 41, hue: 30 }, // æ—¥å¸¸è¡—æ‹æ¿¾é¡
            'filter8': { exposure: -60, contrast: 50, saturation: 50, vibrance: 50, hue: 35 }, // çµ•ç¾æ—¥è½æ¿¾é¡
            'filter9': { exposure: -10, contrast: 0, saturation: -10, vibrance: -15, hue: -20 }, // éœè¬æš—èª¿
        };
        
        // ----------------------------------------------------
        // 2. æ‡‰ç”¨ç¨‹å¼é‚è¼¯
        // ----------------------------------------------------
        const fileInput = document.getElementById('photo-upload');
        const canvas = document.getElementById('photo-canvas');
        const saveButton = document.getElementById('save-button');
        let camanInstance = null; // å„²å­˜ Caman å¯¦ä¾‹
        let originalImageURL = null; // å„²å­˜åŸå§‹åœ–ç‰‡çš„ DataURL

        /**
         * è®€å–ç”¨æˆ¶é¸æ“‡çš„åœ–ç‰‡ä¸¦åˆå§‹åŒ– CamanJS
         */
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                originalImageURL = event.target.result;
                
                // å¿…é ˆå…ˆè¨­ç½®åœ–ç‰‡å±¬æ€§è®“ CamanJS çŸ¥é“è¦è®€å–å“ªå€‹åœ–ç‰‡
                const img = new Image();
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    canvas.style.display = 'block';
                    saveButton.style.display = 'block';

                    // åˆå§‹åŒ– Caman å¯¦ä¾‹
                    camanInstance = Caman('#photo-canvas', originalImageURL, function () {
                        // åˆå§‹åŒ–å¾Œç«‹å³é‡ç½®
                        this.revert(true);
                    });
                }
                img.src = originalImageURL;
            };
            reader.readAsDataURL(file);
        });

        /**
         * æ‡‰ç”¨ CamanJS æ¿¾é¡æ•ˆæœ
         * @param {string} filterKey - æ¿¾é¡çš„éµå (e.g., 'filter1', 'reset')
         */
        function applyFilter(filterKey) {
            if (!camanInstance) {
                alert('è«‹å…ˆä¸Šå‚³ç…§ç‰‡ï¼');
                return;
            }

            // 1. é‡ç½®ç‚ºåŸå§‹åœ–ç‰‡
            camanInstance.revert(false); // ä¿æŒç•¶å‰åœ–åƒæ•¸æ“šï¼Œä½†ç§»é™¤æ¿¾é¡æ­·å²
            
            if (filterKey === 'reset') {
                camanInstance.render(); // é‡æ–°æ¸²æŸ“ (å³é¡¯ç¤ºåŸå§‹åœ–ç‰‡)
                return;
            }

            const f = FILTERS[filterKey];
            if (!f) return;

            // 2. æ‡‰ç”¨æ¿¾é¡åƒæ•¸
            camanInstance.process('vibe_filter', function() {
                // å°‡æ‰€æœ‰èª¿æ•´æ‡‰ç”¨æ–¼ this
                this.exposure(f.exposure || 0);
                this.contrast(f.contrast || 0);
                this.saturation(f.saturation || 0);
                this.vibrance(f.vibrance || 0);
                this.clarity(f.clarity || 0); 
                this.hue(f.hue || 0);
                // ç‚ºäº†æ¨¡æ“¬æ›´è¤‡é›œçš„å½±èª¿ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ sepia æˆ–å…¶ä»–æ•ˆæœ
                // this.sepia(f.sepia || 0); 
            });

            // 3. æ¸²æŸ“æœ€çµ‚æ•ˆæœ
            camanInstance.render();
        }

        /**
         * è™•ç†æŒ‰éˆ•é»æ“Šäº‹ä»¶
         */
        document.getElementById('controls-container').addEventListener('click', (e) => {
            const button = e.target.closest('.vibe-button');
            if (button) {
                const filter = button.dataset.filter;
                applyFilter(filter);
            }
        });

        /**
         * å„²å­˜åœ–ç‰‡åŠŸèƒ½ (ä½¿ç”¨ CamanJS å…§å»ºçš„ save å‡½å¼)
         */
        saveButton.addEventListener('click', () => {
            if (!camanInstance) {
                alert('æ²’æœ‰å¯å„²å­˜çš„ç…§ç‰‡ï¼è«‹å…ˆä¸Šå‚³ä¸¦ç·¨è¼¯ã€‚');
                return;
            }

            // ä½¿ç”¨ CamanJS çš„ save å‡½å¼ï¼Œå®ƒå°‡ Canvas è½‰æ›ç‚ºåœ–ç‰‡ä¸¦è§¸ç™¼ä¸‹è¼‰
            camanInstance.save({
                name: "iPhone_Vibe_Edit.png" 
            });
            alert('ç…§ç‰‡å·²é–‹å§‹ä¸‹è¼‰ï¼');
        });

        // åˆå§‹åŒ–ï¼šé»æ“Šä¸Šå‚³å€åŸŸè§¸ç™¼æª”æ¡ˆé¸æ“‡
        document.getElementById('upload-container').addEventListener('click', () => {
            fileInput.click();
        });
        
    </script>
</body>
</html>
